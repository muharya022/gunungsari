{% load static %}
<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tambah Fasilitas</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Leaflet CSS -->
    <link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <style>
      /* Styling untuk peta */
      #map {
        height: 400px;
        width: 70%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card p-4 mb-5 mt-5">
        <h2 class="text-success mb-4">
          <i class="bi bi-building-add"></i> Tambah Fasilitas
        </h2>

        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <!-- Inputan Nama, Lokasi, Kapasitas, dan Foto -->
          <div class="mb-3">
            <label class="form-label">Nama Fasilitas</label>
            <input
              type="text"
              name="nama"
              class="form-control"
              placeholder="Masukkan nama fasilitas"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Lokasi</label>
            <input
              type="text"
              name="lokasi"
              class="form-control"
              placeholder="Masukkan lokasi"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Kapasitas</label>
            <input
              type="number"
              name="kapasitas"
              class="form-control"
              placeholder="Masukkan kapasitas"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Foto Fasilitas</label>
            <input
              type="file"
              name="foto"
              class="form-control"
              accept="image/*"
            />
          </div>

          <!-- Peta Interaktif -->
          <div class="mb-3">
            <label class="form-label">Pilih Lokasi di Peta</label>
            <div id="map"></div>
            <input type="hidden" name="latitude" id="latitude" />
            <input type="hidden" name="longitude" id="longitude" />
          </div>

          <button type="submit" class="btn btn-success">
            <i class="bi bi-save"></i> Simpan
          </button>
          <a href="/fasilitas/" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Kembali
          </a>
        </form>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
      // Inisialisasi peta
      var map = L.map("map").setView(
        [-4.506109615077847, 121.52219288553799],
        15
      );

      // Menambahkan tile layer
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      // Menambahkan marker dan event click
      var marker = L.marker([-4.506109615077847, 121.52219288553799]).addTo(
        map
      );
      marker.bindPopup("Lokasi Fasilitas").openPopup();

      map.on("click", function (e) {
        var lat = e.latlng.lat;
        var lng = e.latlng.lng;

        // Memperbarui marker dan input koordinat
        marker.setLatLng([lat, lng]);
        document.getElementById("latitude").value = lat;
        document.getElementById("longitude").value = lng;
      });
    </script>

    {% if messages %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    {% for message in messages %}
      Swal.fire({
        icon: 'info',  // bisa diganti 'success', 'error', 'warning' sesuai kebutuhan
        title: 'Info',
        text: "{{ message|escapejs }}",
        confirmButtonText: 'OK'
      });
    {% endfor %}
  });
</script>
{% endif %}

  </body>
</html>
